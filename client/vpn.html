<head>
  <title>VPN project</title>
</head>

<body>
</body>

<template name="MyLayout">
  {{> show_dialog}}
  <div class="container-fluid">

   <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <div class="right-buttons">
	<div class="side-by-side">
	  <a href="https://github.com/strawlab/neuron-catalog/issues/new">Report an issue <i class="fa fa-github"></i></a>
	</div>
	<div class="side-by-side">
	  {{> loginButtons}}
	</div>
      </div>

      <ul class="nav nav-tabs" role="tablist">
	<li {{tab_attrs_home}}><a href="{{pathFor 'home'}}">home</a></li>
	<li {{tab_attrs_driver_lines}}>
	  <a href="{{pathFor 'driver_lines'}}">Driver Lines</a>
	</li>
	<li {{tab_attrs_neuron_types}}>
	  <a href="{{pathFor 'neuron_types'}}">Neuron Types</a>
	</li>
	<li {{tab_attrs_neuropils}}>
	  <a href="{{pathFor 'neuropils'}}">Neuropils</a>
	</li>
      </ul>
    </div>
   </div>

   <div class="row">
    <div class="col-md-10 col-md-offset-1">

  <article>
    {{> yield}}
  </article>

    </div>
   </div>

   <div class="row">
    <div class="col-md-10 col-md-offset-1">

    </div>
   </div>

  </div>
</template>

<template name="home">
  <h1>Neuron Catalog</h1>

  <p>
    {{#if currentUser}}
    Welcome back to our database.
    {{else}}
    Welcome to our database. {{login_message}}
    {{/if}}
  </p>

  <p>This software was developed by
  the <a href="http://strawlab.org/">Straw Lab</a> and is based
  on <a href="http://meteor.com/">Meteor</a>. The work was supported
  by <a href="http://erc.europa.eu/">ERC</a> Starting Grant 281884
  FlyVisualCircuits and by <a href="http://www.imp.ac.at/">IMP</a>
  core funding.</p>

  Our project page is on GitHub <i class="fa fa-github"></i>
  as <a href="https://github.com/strawlab/neuron-catalog">strawlab/neuron-catalog</a>.


</template>

<template name="name_field">
  {{#if editing_name}}
  <input type="text" id="name_input"/>
  {{else}}
  <div class="name-field edit-name">{{name}}
    <a class="btn btn-default btn-small edit-name" href="#"><i class="fa fa-pencil-square-o"></i> Edit name</a>
  </div>
  {{/if}}
</template>

<template name="delete_button">
  <a class="btn btn-danger btn-small delete" href="#"><i class="fa fa-trash-o"></i> Delete</a>
</template>

<template name="driver_line_from_id_block">
  {{#with driver_line_from_id}}
    {{> UI.contentBlock this}}
  {{/with}}
</template>

<template name="neuron_type_from_id_block">
  {{#with neuron_type_from_id}}
    {{> UI.contentBlock this}}
  {{/with}}
</template>

<template name="neuropil_from_id_block">
  {{#with neuropil_from_id}}
    {{> UI.contentBlock this}}
  {{/with}}
</template>

<template name="detail_block_top">
  {{> UI.contentBlock this}}
</template>

<template name="detail_title_top">
  <div class="detail-title-top">
    {{> UI.contentBlock this}}
  </div>
</template>

<template name="detail_block">
  <div class="detail-block">
    {{> UI.contentBlock this}}
  </div>
</template>

<template name="detail_title">
  <div class="detail-title">
    {{> UI.contentBlock this}}
  </div>
</template>

<template name="detail_main">
  {{> UI.contentBlock this}}
</template>

<template name="driver_line_table">
  <table class="table table-striped">
    <thead>
      <tr>
	<th>Driver line</th>
	<th>Neuron types</th>
	<th>Neuropils</th>
      </tr>
    </thead>
    <tbody>
      {{#each driver_lines}}
      {{#driver_line_from_id_block}}
      <tr>
	<td>
	  <a href="{{pathFor 'driver_line_show'}}"><span {{zxkp}}>{{name}}</span></a>
	</td>
	<td>
	  {{#each neuron_types}}
	  {{#neuron_type_from_id_block}}
	  <a href="{{pathFor 'neuron_type_show'}}"><span {{zxkp}}>{{name}}</span></a>
	  {{/neuron_type_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each neuropils}}
	  {{#neuropil_from_id_block}}
	  <a href="{{pathFor 'neuropil_show'}}"><span {{zxkp}}>{{name}}</span></a>
	  {{/neuropil_from_id_block}}
	  {{/each}}
	</td>
      </tr>
      {{/driver_line_from_id_block}}
      {{/each}}
    </tbody>
  </table>
</template>

<template name="neuron_type_table">
  <table class="table table-striped">
    <thead>
      <tr>
	<th>Neuron type</th>
	<th>Synonyms</th>
	<th>Best driver lines</th>
	<th>Neuropils</th>
      </tr>
    </thead>
    <tbody>
      {{#each neuron_types}}
      {{#neuron_type_from_id_block}}
      <tr>
	<td>
	  <a href="{{pathFor 'neuron_type_show'}}"><span {{zxkp}}>{{name}}</span></a>
	</td>
	<td>
	  {{#each synonyms}}
	  <span {{zxkp}}>{{this}}</span>
	  {{/each}}
	</td>
	<td>
	  {{#each best_driver_lines}}
          {{#driver_line_from_id_block}}
            <a href="{{pathFor 'driver_line_show'}}"><span {{zxkp}}>{{name}}</span></a>
          {{/driver_line_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each neuropils}}
          {{#neuropil_from_id_block}}
          <a href="{{pathFor 'neuropil_show'}}"><span {{zxkp}}>{{name}}</span></a>
          {{/neuropil_from_id_block}}
	  {{/each}}
	</td>
      </tr>
      {{/neuron_type_from_id_block}}
      {{/each}}
    </tbody>
  </table>
</template>

<template name="neuropil_table">
  <table class="table table-striped">
    <thead>
      <tr>
	<th>Neuropil</th>
	<th>Driver lines</th>
	<th>Neuron types</th>
      </tr>
    </thead>
    <tbody>
      {{#each neuropils}}
      {{#neuropil_from_id_block}}
      <tr>
	<td>
          <a href="{{pathFor 'neuropil_show'}}"><span {{zxkp}}>{{name}}</span></a>
	</td>
	<td>
	  {{#each driver_lines_referencing_me}}
          {{#driver_line_from_id_block}}
          <a href="{{pathFor 'driver_line_show'}}"><span {{zxkp}}>{{name}}</span></a>
          {{/driver_line_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each neuron_types_referencing_me}}
          {{#neuron_type_from_id_block}}
          <a href="{{pathFor 'neuron_type_show'}}"><span {{zxkp}}>{{name}}</span></a>
          {{/neuron_type_from_id_block}}
	  {{/each}}
	</td>
      </tr>
      {{/neuropil_from_id_block}}
      {{/each}}
    </tbody>
  </table>
</template>

<!-- --------------------------- -->

<template name="driver_lines">
  {{#detail_block_top}}
    {{#detail_title_top}}
      All Driver Lines
    {{/detail_title_top}}
    {{#detail_main}}

      {{> driver_line_table driver_lines=driver_line_cursor}}

      {{#if currentUser}}
      <a class="btn btn-default insert" href="#">
	<i class="fa fa-plus"></i> Add a new driver line</a>
      {{else}}
        {{login_message}}
      {{/if}}
    {{/detail_main}}
  {{/detail_block_top}}

</template>

<template name="driver_line_show_brief">
  {{#driver_line_from_id_block}}
  <h3>Driver Line: {{name}}</h3>
  {{/driver_line_from_id_block}}
</template>

<template name="driver_line_show">
  {{#driver_line_from_id_block}}
  {{#detail_block_top}}
    {{#detail_title_top}}
        Driver Line:
        {{> name_field collection="DriverLines" my_id=_id name=name}}
        {{> delete_button collection="DriverLines" my_id=_id}}
    {{/detail_title_top}}
  {{/detail_block_top}}

  {{#detail_block}}
    {{#detail_title}}
      Neuron types
      <a class="btn btn-default btn-small edit-neuron-types" href="#"><i class="fa fa-pencil-square-o"></i> edit</a>

    {{/detail_title}}
    {{#detail_main}}
      {{> neuron_type_table neuron_types=neuron_types}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
      Neuropils
      <a class="btn btn-default btn-small edit-neuropils" href="#"><i class="fa fa-pencil-square-o"></i> edit</a>
    {{/detail_title}}
    {{#detail_main}}
      {{> neuropil_table neuropils=neuropils}}
    {{/detail_main}}
  {{/detail_block}}

  {{> comments_panel comments=comments show_name="DriverLines" _id=_id}}
  {{/driver_line_from_id_block}}
</template>

<template name="comments_panel">
  {{#detail_block}}
    {{#detail_title}}
      Comments
    {{/detail_title}}
    {{#detail_main}}
      {{> show_comments comments=comments show_name=show_name _id=_id}}
      <div class="comments comments-edit">
	<div class="comments comments-textarea">
	  <textarea class="comments" placeholder="Leave a comment here. Parsed as Markdown."></textarea>
	</div>
        <button type="button" class="btn btn-primary save">Save comment</button>
      </div>
    {{/detail_main}}
  {{/detail_block}}
</template>

<!-- --------------------------- -->

<template name="neuron_types">
  {{#detail_block_top}}
    {{#detail_title_top}}
  All Neuron Types
    {{/detail_title_top}}
    {{#detail_main}}

  {{> neuron_type_table neuron_types=neuron_type_cursor}}

  {{#if currentUser}}
  <a class="btn btn-default insert" href="#">
    <i class="fa fa-plus"></i> Add a new neuron type</a>
  {{else}}
  {{login_message}}
  {{/if}}
    {{/detail_main}}
  {{/detail_block_top}}
</template>

<template name="neuron_type_show_brief">
  {{#neuron_type_from_id_block}}
  <h3>Neuron type: {{name}}</h3>
  {{/neuron_type_from_id_block}}
</template>

<template name="neuron_type_show">
  {{#neuron_type_from_id_block}}
  {{#detail_block_top}}
    {{#detail_title_top}}
	Neuron type:
        {{> name_field collection="NeuronTypes" my_id=_id name=name}}
        {{> delete_button collection="NeuronTypes" my_id=_id}}
    {{/detail_title_top}}
  {{/detail_block_top}}

  {{#detail_block}}
    {{#detail_title}}
	Synonyms
    {{/detail_title}}
    {{#detail_main}}
      <p></p>
      <div class="synonyms_div">
	<div class="item-synonyms">
	  {{#each synonym_dicts}}

          <div class="btn btn-default btn-small">
	    <div class="pzp1 name">{{name}}</div>
	    <div class="pzp2 remove"><i class="fa fa-trash-o"></i></div>
	  </div>
	  {{/each}}
	  {{#if adding_synonym}}
	  <div class="synonym edit_synonym">
	    <input type="text" id="edit_synonym_input" value="" />
	  </div>
	  {{else}}
	  <div class="synonym add_synonym">
	    <a class="btn btn-default btn-small insert" href="#">
	      <i class="fa fa-plus"></i> Add synonym</a>
	  </div>
	  {{/if}}
	</div>
      </div>
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
      Best driver lines
      <a class="btn btn-default btn-small edit-driver-lines" href="#"><i class="fa fa-pencil-square-o"></i> edit</a>
    {{/detail_title}}
    {{#detail_main}}
      {{> driver_line_table driver_lines=best_driver_lines}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
	Neuropils
      <a class="btn btn-default btn-small edit-neuropils" href="#"><i class="fa fa-pencil-square-o"></i> edit</a>
    {{/detail_title}}
    {{#detail_main}}
      {{> neuropil_table neuropils=neuropils}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
	Driver lines
        {{>derived_title}}
    {{/detail_title}}
    {{#detail_main}}
      {{> driver_line_table driver_lines=driver_lines_referencing_me}}
    {{/detail_main}}
  {{/detail_block}}

  {{> comments_panel comments=comments show_name="NeuronTypes" _id=_id}}
  {{/neuron_type_from_id_block}}
</template>

<template name="edit_driver_lines">
  <div>
    <div><h4>driver lines</h4></div>
    <div>
      {{#each driver_lines}}
      <div class="checkbox">
	<label>
	  <input type="checkbox" class="driver_lines" id={{_id}} checked={{is_checked}}/> {{name}}
	</label>
      </div>
      {{/each}}
    </div>
  </div>
</template>

<template name="edit_neuron_types">
  <div>
    <div><h4>neuron types</h4></div>
    <div>
      {{#each neuron_types}}
      <div class="checkbox">
	<label>
	  <input type="checkbox" class="neuron_types" id={{_id}} checked={{is_checked}}/> {{name}}
	</label>
      </div>
      {{/each}}
    </div>
  </div>
</template>

<template name="edit_neuropils">
  <div>
    <div><h4>neuropils</h4></div>
    <div>
      {{#each neuropils}}
      <div class="checkbox">
	<label>
	  <input type="checkbox" class="neuropils" id={{_id}} checked={{is_checked}}/> {{name}}
	</label>
      </div>
      {{/each}}
    </div>
  </div>
</template>

<!-- --------------------------- -->

<template name="neuropils">
  {{#detail_block_top}}
    {{#detail_title_top}}
      All Neuropils
    {{/detail_title_top}}
    {{#detail_main}}
  {{> neuropil_table neuropils=neuropil_cursor}}

  {{#if currentUser}}
  <a class="btn btn-default insert" href="#">
    <i class="fa fa-plus"></i> Add a new neuropil</a>
  {{else}}
  {{login_message}}
  {{/if}}
    {{/detail_main}}
  {{/detail_block_top}}

</template>

<template name="neuropil_show_brief">
  {{#neuropil_from_id_block}}
  <h3>Neuropil: {{name}}</h3>
  {{/neuropil_from_id_block}}
</template>

<template name="neuropil_show">
  {{#neuropil_from_id_block}}

  {{#detail_block_top}}
    {{#detail_title_top}}
      Neuropil:
      {{> name_field collection="Neuropils" my_id=_id name=name}}
      {{> delete_button collection="Neuropils" my_id=_id}}
    {{/detail_title_top}}
  {{/detail_block_top}}

  {{#detail_block}}
    {{#detail_title}}
      Driver lines
      {{>derived_title}}
    {{/detail_title}}
    {{#detail_main}}
      {{> driver_line_table driver_lines=driver_lines_referencing_me}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
      Neuron types
      {{>derived_title}}
    {{/detail_title}}
    {{#detail_main}}
      {{> neuron_type_table neuron_types=neuron_types_referencing_me}}
    {{/detail_main}}
  {{/detail_block}}

  {{> comments_panel comments=comments show_name="Neuropils" _id=_id}}
  {{/neuropil_from_id_block}}
</template>

<!-- --------------------------- -->

<template name="show_dialog">
  {{#with modal_info}}
  <div class="modal fade" id="show_dialog_id">
    <div class="modal-dialog">
      <div class="modal-content">
	<div class="modal-header">
	  <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <h4 class="modal-title">{{title}}</h4>
	</div>
	<div class="modal-body">
	  {{#if error}}
	  <div class="alert alert-danger">{{error}}</div>
	  {{/if}}
	  {{> UI.dynamic template=body_template_name data=body_template_data}}
	</div>
	<div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	  {{#if is_delete_modal}}
          <button type="button" class="btn btn-danger delete">Delete</button>
	  {{else}}
          <button type="button" class="btn btn-primary save">Save</button>
	  {{/if}}
	</div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
  {{/with}}
</template>

<!-- ----------------------------- -->

<template name="driver_line_insert">
  <form role="form">
    <label>Name</label>
    <input type="text" class="name span5"/>

    <div>
      <div><h4>neuron types</h4></div>
      <div>
	{{#each neuron_types}}
	<div class="checkbox">
	  <label>
	    <input type="checkbox" class="neuron_types" id={{_id}}/> {{name}}
	  </label>
	</div>
      {{/each}}
      </div>
    </div>

    <div>
      <div><h4>neuropils</h4></div>
      <div>
	{{#each neuropils}}
	<div class="checkbox">
	  <label>
	    <input type="checkbox" class="neuropils" id={{_id}}/> {{name}}
	  </label>
	</div>
	{{/each}}
      </div>
    </div>
  </form>
</template>

<template name="neuron_type_insert">
  <form role="form">
    <label>Name</label>
    <input type="text" class="name span5"/>

    <div>
      <div><h4>neuropils</h4></div>
      <div>
	{{#each neuropils}}
	<div class="checkbox">
	  <label>
	    <input type="checkbox" class="neuropils" id={{_id}}/> {{name}}
	  </label>
	</div>
	{{/each}}
      </div>
    </div>

  </form>
  <p></p>
  <p>
    Note: driver lines are computed from information about each driver
    line.
  </p>
  {{>derived_title}}
</template>

<template name="neuropil_insert">
  <form>
    <label>Name</label>
    <input type="text" class="name span5"/>
  </form>
  <p></p>
  <p>
    Note: driver lines are computed from information about each driver
    line and neuron types are computed from information about each
    neuron type.
  </p>
  {{>derived_title}}
</template>

<template name="derived_title">
  <div class="btn btn-default btn-tiny">
    <i class="fa fa-download"></i> From remote data
  </div>
</template>

<!-- ---------------------------- -->

<template name="show_comments">
  {{#each wrapped_comments}}
  <div>
    <div class="remove-indiv-comment">
      <a class="btn btn-danger delete" href="#" title="delete comment"><i class="fa fa-trash-o"></i></a>
    </div>
    <div class="indiv-comment">
      {{{show_markdown comment}}}
    </div>
  </div>
  {{/each}}
</template>
