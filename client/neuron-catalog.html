<head>
  <title>neuron catalog</title>
</head>

<body>
</body>

<template name="MyLayout">
  {{>UploadProcessorStatus}}
  {{> show_dialog}}
  {{> show_upload_progress}}
  <div class="{{top_margin_class_attrs}}">

   <div class="row">
    <div class="col-md-5 col-md-offset-6">
      <span class="side-by-side">
	<a href="https://github.com/strawlab/neuron-catalog/issues/new">Report an issue <i class="fa fa-github"></i></a>
      </span>
      <span class="side-by-side">
	{{> loginButtons}}
      </span>
    </div>
   </div>
   <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <ul class="nav navbar-nav" role="tablist">
	<li class="{{activeIfTemplateIn 'home'}}"><a href="{{pathFor 'home'}}">Home</a></li>
	<li class="{{activeIfTemplateIn 'driver_lines' 'driver_line_show'}}">
	  <a href="{{pathFor 'driver_lines'}}">Driver Lines</a>
	</li>
	<li class="{{activeIfTemplateIn 'neuron_types' 'neuron_type_show'}}">
	  <a href="{{pathFor 'neuron_types'}}">Neuron Types</a>
	</li>
	<li class="{{activeIfTemplateIn 'neuropils' 'neuropil_show'}}">
	  <a href="{{pathFor 'neuropils'}}">Brain Regions</a>
	</li>
	<li class="{{activeIfTemplateIn 'binary_data' 'binary_data_show'}}">
	  <a href="{{pathFor 'binary_data'}}">Binary Data</a>
	</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
	<li class="{{activeIfTemplateIn 'RecentChanges'}}">
	  <a href="{{pathFor 'RecentChanges'}}"><i class="fa fa-line-chart"></i> Recent Changes</a>
	</li>
	<li class="{{activeIfTemplateIn 'Search'}}">
	  <a href="{{pathFor 'Search'}}"><i class="fa fa-search"></i> Search</a>
	</li>
	<li class="{{activeIfTemplateIn 'config'}}">
	  <a href="{{pathFor 'config'}}"><i class="fa fa-cog"></i> Config</a>
	</li>
      </ul>
    </div>
   </div>

   <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <article>
        {{> yield}}
      </article>
    </div>
   </div>

  </div>

</template>

<template name="home">
  {{#top_content_row}}
    {{#with config}}
      {{project_name}}
    {{/with}}
  {{/top_content_row}}

  <p>
    {{#if currentUser}}
      Welcome back.
    {{else}}
      Welcome. {{login_message}}
    {{/if}}
  </p>

  {{#detail_block}}
    {{#detail_title}}
	About the data
    {{/detail_title}}
    {{#detail_main}}

  <p>
    {{#with config}}
      The data here are from the
      project <span class="bold">{{project_name}}</span> by
      <span class="bold">{{{data_authors}}}</span>. {{{blurb}}}
    {{/with}}
  </p>
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
	About this website software
    {{/detail_title}}
    {{#detail_main}}

  <p>This software was developed by
  the <a href="http://strawlab.org/">Straw Lab</a> and is based
  on <a href="http://meteor.com/">Meteor</a>. The software development
  was supported by <a href="http://erc.europa.eu/">ERC</a> Starting
  Grant 281884 FlyVisualCircuits and
  by <a href="http://www.imp.ac.at/">IMP</a> core funding. Software
  development happens on GitHub <i class="fa fa-github"></i> in
  the <a href="https://github.com/strawlab/neuron-catalog">strawlab/neuron-catalog</a>
  project.
  </p>

    {{/detail_main}}
  {{/detail_block}}

</template>

<template name="UploadProcessorStatus">
  {{#if get_upload_processor_has_error}}
     <div class="alert alert-danger fixed-top" role="alert">

       <p>There is currently a problem on the server. New images and
       other binary data are not being processed. You can still upload
       files, but they may not display correctly.</p>

     </div>
  {{/if}}
</template>

<template name="delete_button">
  <a class="btn btn-danger btn-small delete" href="#"><i class="fa fa-trash-o"></i> Delete</a>
</template>

<template name="raw_button">
  <a class="btn btn-default btn-small raw" href="#"><i class="fa fa-terminal"></i>{{#if button_text}}{{button_text}}{{else}}View raw document{{/if}}</a>
</template>

<template name="raw_document_view">
  <div>
    This document is in the collection: <span class="code">{{collection}}</span>
  </div>
  <div>
    <pre>{{raw_document}}</pre>
  </div>
</template>

<template name="driver_line_from_id_block">
  {{#with driver_line_from_id}}
    {{> UI.contentBlock this}}
  {{/with}}
</template>

<template name="binary_data_from_id_block">
  {{#with binary_data_from_id}}
    {{> UI.contentBlock this}}
  {{/with}}
</template>

<template name="neuron_type_from_id_block">
  {{#with neuron_type_from_id}}
    {{> UI.contentBlock this}}
  {{/with}}
</template>

<template name="neuropil_from_id_block">
  {{#with neuropil_from_id}}
    {{> UI.contentBlock this}}
  {{/with}}
</template>

<template name="detail_block">
  <div class="detail-block">
    {{> UI.contentBlock this}}
  </div>
</template>

<template name="detail_title">
  <div class="detail-title">
    {{> UI.contentBlock this}}
  </div>
</template>

<template name="detail_main">
  {{> UI.contentBlock this}}
</template>

<template name="driver_line_table">
  <table class="table table-striped">
    <thead>
      <tr>
	<th>Driver line</th>
	<th>Neuron types</th>
	<th>Brain Regions (nonspecific expression)</th>
	<th>Output neuropils</th>
	<th>Input neuropils</th>
      </tr>
    </thead>
    <tbody>
      {{#each driver_lines}}
      {{#driver_line_from_id_block}}
      <tr>
	<td>
	  <a href="{{pathFor 'driver_line_show'}}"><span class="keep-together">{{name}}</span></a>
	</td>
	<td>
	  {{#each neuron_types}}
	  {{#neuron_type_from_id_block}}
	  <a href="{{pathFor 'neuron_type_show'}}"><span class="keep-together">{{name}}</span></a>
	  {{/neuron_type_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each get_neuropils this "unspecified"}}
	  {{#neuropil_from_id_block}}
	  <a href="{{pathFor 'neuropil_show'}}"><span class="keep-together">{{name}}</span></a>
	  {{/neuropil_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each get_neuropils this "output"}}
	  {{#neuropil_from_id_block}}
	  <a href="{{pathFor 'neuropil_show'}}"><span class="keep-together">{{name}}</span></a>
	  {{/neuropil_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each get_neuropils this "input"}}
	  {{#neuropil_from_id_block}}
	  <a href="{{pathFor 'neuropil_show'}}"><span class="keep-together">{{name}}</span></a>
	  {{/neuropil_from_id_block}}
	  {{/each}}
	</td>
      </tr>
      {{/driver_line_from_id_block}}
      {{/each}}
    </tbody>
  </table>
</template>

<template name="neuron_type_table">
  <table class="table table-striped">
    <thead>
      <tr>
	<th>Neuron type</th>
	<th>Synonyms</th>
	<th>Best driver lines</th>
	<th>Brain Regions (nonspecific expression)</th>
	<th>Output neuropils</th>
	<th>Input neuropils</th>
      </tr>
    </thead>
    <tbody>
      {{#each neuron_types}}
      {{#neuron_type_from_id_block}}
      <tr>
	<td>
	  <a href="{{pathFor 'neuron_type_show'}}"><span class="keep-together">{{name}}</span></a>
	</td>
	<td>
	  {{#each synonyms}}
	  <span class="keep-together">{{this}}</span>
	  {{/each}}
	</td>
	<td>
	  {{#each best_driver_lines}}
          {{#driver_line_from_id_block}}
            <a href="{{pathFor 'driver_line_show'}}"><span class="keep-together">{{name}}</span></a>
          {{/driver_line_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each get_neuropils this "unspecified"}}
	  {{#neuropil_from_id_block}}
	  <a href="{{pathFor 'neuropil_show'}}"><span class="keep-together">{{name}}</span></a>
	  {{/neuropil_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each get_neuropils this "output"}}
	  {{#neuropil_from_id_block}}
	  <a href="{{pathFor 'neuropil_show'}}"><span class="keep-together">{{name}}</span></a>
	  {{/neuropil_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each get_neuropils this "input"}}
	  {{#neuropil_from_id_block}}
	  <a href="{{pathFor 'neuropil_show'}}"><span class="keep-together">{{name}}</span></a>
	  {{/neuropil_from_id_block}}
	  {{/each}}
	</td>
      </tr>
      {{/neuron_type_from_id_block}}
      {{/each}}
    </tbody>
  </table>
</template>

<template name="neuropil_table">
  <table class="table table-striped">
    <thead>
      <tr>
	<th>Brain Region</th>
	<th>Driver lines</th>
	<th>Neuron types</th>
	<th>Expression type</th>
      </tr>
    </thead>
    <tbody>
      {{#each neuropils}}
      {{#neuropil_from_id_block}}
      <tr>
	<td>
          <a href="{{pathFor 'neuropil_show'}}"><span class="keep-together">{{name}}</span></a>
	</td>
	<td>
	  {{#each driver_lines_referencing_me}}
          {{#driver_line_from_id_block}}
          <a href="{{pathFor 'driver_line_show'}}"><span class="keep-together">{{name}}</span></a>
          {{/driver_line_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each neuron_types_referencing_me}}
          {{#neuron_type_from_id_block}}
          <a href="{{pathFor 'neuron_type_show'}}"><span class="keep-together">{{name}}</span></a>
          {{/neuron_type_from_id_block}}
	  {{/each}}
	</td>
	<td>
	  {{#each my_types}}
	    {{this}}
	  {{/each}}
	</td>
      </tr>
      {{/neuropil_from_id_block}}
      {{/each}}
    </tbody>
  </table>
</template>

<!-- --------------------------- -->

<template name="top_content_row">
  <div class="detail-title-top">
    {{> UI.contentBlock this}}
  </div>
</template>

<template name="top_content_row2">
<div class="detail-title-top-text">
  <div class="row">
    <div class="col-sm-8 col-sm-offset-2 align-center">
      <div>
        {{type_name}}:
        {{#if editing_name}}
          <input type="text" id="name-input">
	{{else}}
	  <span class="edit-name">{{name}}</span>
	{{/if}}
      </div>
    </div>
  </div>
</div>
<div>
  <div class="row">
    <div class="col-sm-2">
      <div>Previous:</div>
      {{> next_previous_button collection=collection my_id=_id which="previous"}}
    </div>
    <div class="col-sm-8 align-center">
      <a class="btn btn-default btn-small edit-name" href="#"><i class="fa fa-pencil-square-o"></i> Edit name</a>
      {{> raw_button collection=collection my_id=_id}}
      {{> delete_button collection=collection my_id=_id}}
    </div>
    <div class="col-sm-2 right-text">
      <div>Next:</div>
      {{> next_previous_button collection=collection my_id=_id which="next"}}
    </div>
  </div>
</div>
</template>

<template name="driver_lines">
  {{#top_content_row}}
      All Driver Lines
  {{/top_content_row}}

  {{#detail_block}}
    {{#detail_main}}

      {{> driver_line_table driver_lines=driver_line_cursor}}

      {{#if currentUser}}
      <a class="btn btn-default insert" href="#">
	<i class="fa fa-plus"></i> Add a new driver line</a>
      {{else}}
        {{login_message}}
      {{/if}}
    {{/detail_main}}
  {{/detail_block}}

</template>

<template name="driver_line_show_brief">
  {{#driver_line_from_id_block}}
  <h3>Driver Line: {{name}}</h3>
  {{/driver_line_from_id_block}}
</template>

<template name="next_previous_button">
  {{>linkout get_linkout}}
</template>

<template name="driver_line_show">
  {{#driver_line_from_id_block}}
  {{>top_content_row2 type_name="Driver Line" collection="DriverLines" _id=_id name=name}}

  {{> tags_panel tags=tags collection="DriverLines" _id=_id}}

  {{#if is_vt_gal4_line}}
  {{#detail_block}}
    {{#detail_title}}
      Links to remote resources
    {{/detail_title}}
    {{#detail_main}}
      <a class="btn btn-default btn-small" href="{{vdrc_url}}"><i class="fa fa-long-arrow-right"></i> VDRC</a>
      <a class="btn btn-default btn-small" href="{{brainbase_url}}"><i class="fa fa-long-arrow-right"></i> BrainBase</a>
    {{/detail_main}}
  {{/detail_block}}
  {{/if}}

  {{#detail_block}}
    {{#detail_title}}
        {{> AddImageCode2 collection="DriverLines" my_id=_id}}
    {{/detail_title}}
    {{#detail_main}}
      <br/>
        {{> binary_data_table binary_data=images}}
        {{> add_image_code collection="DriverLines" my_id=_id}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
      Neuron types
      <a class="btn btn-default btn-small edit-neuron-types" href="#"><i class="fa fa-pencil-square-o"></i> edit</a>

    {{/detail_title}}
    {{#detail_main}}
      {{> neuron_type_table neuron_types=neuron_types}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
      Brain Regions
      <a class="btn btn-default btn-small edit-neuropils" href="#"><i class="fa fa-pencil-square-o"></i> edit</a>
    {{/detail_title}}
    {{#detail_main}}
      {{> neuropil_table neuropils=neuropils}}
    {{/detail_main}}
  {{/detail_block}}

  {{> FlyCircuitPanel flycircuit_idids=flycircuit_idids collection="DriverLines" _id=_id}}

  {{> comments_panel comments=comments show_name="DriverLines" _id=_id}}
  {{/driver_line_from_id_block}}
</template>

<template name="comments_panel">
  {{#detail_block}}
    {{#detail_title}}
      Comments
    {{/detail_title}}
    {{#detail_main}}
      {{> show_comments comments=comments show_name=show_name _id=_id}}

  <ul class="nav nav-tabs" role="tablist">
    {{#if is_previewing_comment}}
    <li class="write-comment"><a href="#">Write</a></li>
    <li class="active preview-comment"><a href="#">Preview</a></li>
    {{else}}
    <li class="active write-comment"><a href="#">Write</a></li>
    <li class="preview-comment"><a href="#">Preview</a></li>
    {{/if}}
  </ul>

      <div class="comments relative-position">
	<div class="comment-ui-field {{is_writing_attrs}}">
	  <textarea class="comments" placeholder="Leave a comment here. Parsed as Markdown."></textarea>
	</div>
	<div class="comment-ui-field2 {{is_previewing_attrs}}" id="comment-preview">{{{comment_preview}}}</div>
	<button type="button" class="btn btn-primary save">Save comment</button>
      </div>
    {{/detail_main}}
  {{/detail_block}}
</template>

<!-- --------------------------- -->

<template name="tags_panel">
  {{#detail_block}}
    {{#detail_title}}
      Tags
    {{/detail_title}}
    {{#detail_main}}
      <p></p>
      <div class="tags-div">
	<div class="item-tags">
          {{#each tag_dicts}}
<div class="btn btn-default btn-small">
	    <div class="pzp1 name">{{name}}</div>
	    <div class="pzp2 remove"><i class="fa fa-trash-o"></i></div>
	  </div>
	  {{/each}}
	  {{#if adding_tag}}
	  <div class="tag edit-tag">
	    <input type="text" id="edit-tag-input" value="" >
	  </div>
	  {{else}}
	  <div class="tag add-tag">
	    <a class="btn btn-default btn-small insert" href="#">
	      <i class="fa fa-plus"></i> Add tag</a>
	  </div>
	  {{/if}}
	</div>
      </div>
    {{/detail_main}}
  {{/detail_block}}
</template>

<!-- --------------------------- -->

<template name="Search">
  {{#if currentUser}}

  <p>
    Text (name, synonyms and comments) search:
    <input type="text" id="comments-search-input" placeholder="search text">
  </p>

  <p>
    FlyCircuit IdId search:
    <input type="text" id="flycircuit-search-input" placeholder="idid number or * for all">
  </p>

  <p>
    Limit by tags:
    {{#each get_tags}}
      <div class="tag-name btn btn-default btn-small {{is_active_css_class}}" data-tag={{name}}>
        {{name}}
      </div>
    {{/each}}
  </p>

  {{#if current_search}}
  <h4>Search results</h4>

  Current search:
  <a class="neuron-catalog-chevron collapsed" data-toggle="collapse" data-target="#current_search_code" aria-expanded="true" aria-controls="demo" href="#"></a>
  <div id="current_search_code" class="collapse">
    <p>This is the MongoDB query currently being executed:</p>
    <code>{{current_search}}</code>
  </div>

  {{#detail_block}}
    {{#detail_title}}Driver Lines{{/detail_title}}
    {{> driver_line_table driver_lines=driver_line_search_cursor}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}Neuron Types{{/detail_title}}
    {{> neuron_type_table neuron_types=neuron_type_search_cursor}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}Brain Regions{{/detail_title}}
    {{> neuropil_table neuropils=neuropil_search_cursor}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}Images and Binary Data{{/detail_title}}
    {{> binary_data_table binary_data=binary_data_search_cursor}}
  {{/detail_block}}
  {{/if}}
  {{else}}
    {{login_message}}
  {{/if}}

</template>

<template name="RecentChanges">
  {{#if currentUser}}
  <input type="range"
	 min="1"
	 max="30"
	 step="1"
	 value="3"
	 id="last_n_days_widget">
  Changes in the last {{last_n_days}} days:
  {{>ChangeList collname="DriverLines" last_n_days=last_n_days}}
  {{>ChangeList collname="NeuronTypes" last_n_days=last_n_days}}
  {{>ChangeList collname="BrainRegions" last_n_days=last_n_days}}
  {{>ChangeList collname="BinaryData" last_n_days=last_n_days}}
  {{else}}
    {{login_message}}
  {{/if}}

</template>

<template name="ChangeList">
  <p>
  {{collname}}
  {{#each wrapped_changes}}
    {{>linkout}}
  {{/each}}
  </p>
</template>

<!-- --------------------------- -->

<template name="binary_data">
  {{#top_content_row}}
      Images and volumes
  {{/top_content_row}}

  {{#detail_block}}
    {{#detail_main}}
        {{> add_image_code}}
        <br/>
        {{> binary_data_table binary_data=binary_data_cursor}}

        {{#if currentUser}}
        {{else}}
          {{login_message}}
        {{/if}}

    {{/detail_main}}
  {{/detail_block}}

</template>

<template name="linkout">
  {{#if this}}
    <a href={{path}}><span class="keep-together">{{name}}</span></a>
  {{/if}}
</template>

<template name="binary_data_show">
  {{#binary_data_from_id_block}}
  {{>top_content_row2 type_name=binary_data_type collection="BinaryData" _id=_id name=name}}

  Documents referencing this:{{#each find_references}} {{>linkout collection=collection my_id=my_id doc=doc}} {{/each}}

  {{#detail_block}}
  <div class="image_big">
    <div class="{{#if is_image_hidden}}{{else}}vis-hidden{{/if}}">Loading <code>{{name}}</code>...</div>
    <img class="aspect_image loadable {{#if is_image_hidden}}vis-hidden{{/if}}" src="{{secure_url_notif}}" alt={{name}}>
    <p>{{name}} [ <a href="{{secure_url_notif}}">cache</a> | <a download="{{name}}" href="{{secure_url}}">original</a> ]</p>
  </div>
  {{hack}}
  {{/detail_block}}

  {{> comments_panel comments=comments show_name="BinaryData" _id=_id}}
  {{/binary_data_from_id_block}}
</template>

<template name="binary_data_show_brief">
  {{#binary_data_from_id_block}}
  {{#top_content_row}}
    Binary data: {{name}}
  {{/top_content_row}}

  {{#detail_block}}
  <div class="image-square">
    <a href="{{pathFor 'binary_data_show'}}"><img class="aspect_image" src="{{secure_url_notif}}" alt={{name}}></a>
    {{name}}
  </div>

  {{/detail_block}}
  {{/binary_data_from_id_block}}
</template>

<!-- --------------------------- -->

<template name="neuron_types">
  {{#top_content_row}}
    All Neuron Types
  {{/top_content_row}}

  {{#detail_block}}
    {{#detail_main}}

  {{> neuron_type_table neuron_types=neuron_type_cursor}}

  {{#if currentUser}}
  <a class="btn btn-default insert" href="#">
    <i class="fa fa-plus"></i> Add a new neuron type</a>
  {{else}}
  {{login_message}}
  {{/if}}
    {{/detail_main}}
  {{/detail_block}}
</template>

<template name="neuron_type_show_brief">
  {{#neuron_type_from_id_block}}
  <h3>Neuron type: {{name}}</h3>
  {{/neuron_type_from_id_block}}
</template>

<template name="neuron_type_show">
  {{#neuron_type_from_id_block}}
  {{>top_content_row2 type_name="Neuron type" collection="NeuronTypes" _id=_id name=name}}

  {{> tags_panel tags=tags collection="NeuronTypes" _id=_id}}

  {{#detail_block}}
    {{#detail_title}}
	Synonyms
    {{/detail_title}}
    {{#detail_main}}
      <p></p>
      <div class="synonyms_div">
	<div class="item-synonyms">
	  {{#each synonym_dicts}}

          <div class="btn btn-default btn-small">
	    <div class="pzp1 name">{{name}}</div>
	    <div class="pzp2 remove"><i class="fa fa-trash-o"></i></div>
	  </div>
	  {{/each}}
	  {{#if adding_synonym}}
	  <div class="synonym edit_synonym">
	    <input type="text" id="edit_synonym_input" value="" >
	  </div>
	  {{else}}
	  <div class="synonym add_synonym">
	    <a class="btn btn-default btn-small insert" href="#">
	      <i class="fa fa-plus"></i> Add synonym</a>
	  </div>
	  {{/if}}
	</div>
      </div>
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
      {{> AddImageCode2 collection="NeuronTypes" my_id=_id}}
    {{/detail_title}}
    {{#detail_main}}
      <br/>
        {{> binary_data_table binary_data=images}}
        {{> add_image_code collection="NeuronTypes" my_id=_id}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
      Best driver lines
      <a class="btn btn-default btn-small edit-driver-lines" href="#"><i class="fa fa-pencil-square-o"></i> edit</a>
    {{/detail_title}}
    {{#detail_main}}
      {{> driver_line_table driver_lines=best_driver_lines}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
	Brain Regions
      <a class="btn btn-default btn-small edit-neuropils" href="#"><i class="fa fa-pencil-square-o"></i> edit</a>
    {{/detail_title}}
    {{#detail_main}}
      {{> neuropil_table neuropils=neuropils}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
	Driver lines
        {{>derived_title}}
    {{/detail_title}}
    {{#detail_main}}
      {{> driver_line_table driver_lines=driver_lines_referencing_me}}
    {{/detail_main}}
  {{/detail_block}}

  {{> FlyCircuitPanel flycircuit_idids=flycircuit_idids collection="NeuronTypes" _id=_id}}

  {{> comments_panel comments=comments show_name="NeuronTypes" _id=_id}}
  {{/neuron_type_from_id_block}}
</template>

<template name="edit_driver_lines">
  <div>
    <div><h4>driver lines</h4></div>
    <div>
      {{#each driver_lines}}
      <div class="checkbox">
	<label>
	  <input type="checkbox" class="driver_lines" id={{_id}} checked={{is_checked}}> {{name}}
	</label>
      </div>
      {{/each}}
    </div>
  </div>
</template>

<template name="edit_neuron_types">
  <div>
    <div><h4>neuron types</h4></div>
    <div>
      {{#each neuron_types}}
      <div class="checkbox">
	<label>
	  <input type="checkbox" class="neuron_types" id={{_id}} checked={{is_checked}}> {{name}}
	</label>
      </div>
      {{/each}}
    </div>
  </div>
</template>

<template name="edit_neuropils">
  <div>
    <div><h4>neuropils</h4></div>
    <div>
      <table class="table table-striped">
	<thead><tr>
	    <td>unspecific</td>
	    <td>output regions (presynaptic)</td>
	    <td>input regions (postsynaptic)</td>
	    <td>name</td>
	</tr></thead>
	<tbody>
      {{#each neuropils}}
	<tr>
	  <td>
            <input type="checkbox" class="neuropils-unspecified" id={{_id}} checked={{unspecific_is_checked}}>
	  </td>
	  <td>
            <input type="checkbox" class="neuropils-output" id={{_id}} checked={{output_is_checked}}>
	  </td>
	  <td>
            <input type="checkbox" class="neuropils-input" id={{_id}} checked={{input_is_checked}}>
	  </td>
	  <td>
            {{name}}
	  </td>
	</tr>
      {{/each}}
	</tbody>
      </table>
    </div>
  </div>
</template>

<!-- --------------------------- -->

<template name="neuropils">
  {{#top_content_row}}
      All Brain Regions
  {{/top_content_row}}

  {{#detail_block}}
    {{#detail_main}}
  {{> neuropil_table neuropils=neuropil_cursor}}

  {{#if currentUser}}
  <a class="btn btn-default insert" href="#">
    <i class="fa fa-plus"></i> Add a new neuropil</a>
  {{else}}
  {{login_message}}
  {{/if}}
    {{/detail_main}}
  {{/detail_block}}

</template>

<template name="neuropil_show_brief">
  {{#neuropil_from_id_block}}
  <h3>Brain Region: {{name}}</h3>
  {{/neuropil_from_id_block}}
</template>

<template name="neuropil_show">
  {{#neuropil_from_id_block}}

  {{>top_content_row2 type_name="Brain Region" collection="BrainRegions" _id=_id name=name}}

  {{> tags_panel tags=tags collection="BrainRegions" _id=_id}}

  {{#detail_block}}
    {{#detail_title}}
      {{> AddImageCode2 collection="BrainRegions" my_id=_id}}
    {{/detail_title}}
    {{#detail_main}}
      <br/>
        {{> binary_data_table binary_data=images}}
        {{> add_image_code collection="BrainRegions" my_id=_id}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
      Driver lines
      {{>derived_title}}
    {{/detail_title}}
    {{#detail_main}}
      {{> driver_line_table driver_lines=driver_lines_referencing_me}}
    {{/detail_main}}
  {{/detail_block}}

  {{#detail_block}}
    {{#detail_title}}
      Neuron types
      {{>derived_title}}
    {{/detail_title}}
    {{#detail_main}}
      {{> neuron_type_table neuron_types=neuron_types_referencing_me}}
    {{/detail_main}}
  {{/detail_block}}

  {{> comments_panel comments=comments show_name="Brain Regions" _id=_id}}
  {{/neuropil_from_id_block}}
</template>

<!-- --------------------------- -->

<template name="show_upload_progress">
  <div class="modal fade" id="show_upload_progress_id">
    <div class="modal-dialog">
      <div class="modal-content">
	<div class="modal-header">
          <h4 class="modal-title">Upload progress</h4>
	</div>
	<div class="modal-body">
	  <div class="upload_progress">
            <div class="progress">
              <div class="progress-bar progress-bar-striped active"  role="progressbar" aria-valuenow="{{percent_uploaded}}" aria-valuemin="0" aria-valuemax="100" style="width: {{percent_uploaded}}%">
		<span class="sr-only">{{percent_uploaded}}% Complete</span>
	      </div>
	    </div>
	  </div>
	</div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</template>

<template name="show_dialog">
  {{#with modal_info}}
  <div class="modal fade" id="show_dialog_id">
    <div class="modal-dialog">
      <div class="modal-content">
	<div class="modal-header">
	  <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <h4 class="modal-title">{{title}}</h4>
	</div>
	<div class="modal-body">
	  {{#if error}}
	  <div class="alert alert-danger">{{error}}</div>
	  {{/if}}
	  {{> UI.dynamic template=body_template_name data=body_template_data}}
	</div>
	<div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	  {{#if is_delete_modal}}
            <button type="button" class="btn btn-danger delete">Delete</button>
	  {{/if}}
	  {{#if is_save_modal}}
            <button type="button" class="btn btn-primary save">Save</button>
	  {{/if}}
	</div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
  {{/with}}
</template>

<!-- ----------------------------- -->

<template name="SaveTemplate">
  <h4 class="modal-title">{{title}}</h4>
  {{> UI.contentBlock this}}
</template>

<template name="AddDriverLineDialog">
  {{#SaveTemplate collection_name="DriverLines" title="add driver line"}}
  <form role="form">
    <label>Name</label>
    <input type="text" class="name span5 driver-line-lookup">
    {{#if count_cursor matching_driver_lines}}
      <div>
        <h4>potential duplicate driver lines</h4>
        {{#each matching_driver_lines}}
          {{>linkout get_linkout}}
        {{/each}}
      </div>
    {{/if}}
    <div>
      <div><h4>neuron types</h4></div>
      <div>
	{{#each neuron_types}}
	<div class="checkbox">
	  <label>
	    <input type="checkbox" class="neuron_types" id={{_id}}> {{name}}
	  </label>
	</div>
      {{/each}}
      </div>
    </div>

    <div>
      <div><h4>neuropils</h4></div>
      <div>
      <table class="table table-striped">
	<thead><tr>
	    <td>unspecific</td>
	    <td>output regions (presynaptic)</td>
	    <td>input regions (postsynaptic)</td>
	    <td>name</td>
	</tr></thead>
	<tbody>
	{{#each neuropils}}
	<tr>
	  <td>
            <input type="checkbox" class="neuropils-unspecified" id={{_id}}>
	  </td>
	  <td>
            <input type="checkbox" class="neuropils-output" id={{_id}}>
	  </td>
	  <td>
            <input type="checkbox" class="neuropils-input" id={{_id}}>
	  </td>
	  <td>
            {{name}}
	  </td>
	</tr>
	{{/each}}
	</tbody>
      </table>
      </div>
    </div>
  </form>
  {{/SaveTemplate}}
</template>

<template name="neuron_type_insert">
  <form role="form">
    <label>Name</label>
    <input type="text" class="name span5">

    <div>
      <div><h4>neuropils</h4></div>
      <div>
      <table class="table table-striped">
	<thead><tr>
	    <td>unspecific</td>
	    <td>output regions (presynaptic)</td>
	    <td>input regions (postsynaptic)</td>
	    <td>name</td>
	</tr></thead>
	<tbody>
	{{#each neuropils}}
	<tr>
	  <td>
            <input type="checkbox" class="neuropils-unspecified" id={{_id}}>
	  </td>
	  <td>
            <input type="checkbox" class="neuropils-output" id={{_id}}>
	  </td>
	  <td>
            <input type="checkbox" class="neuropils-input" id={{_id}}>
	  </td>
	  <td>
            {{name}}
	  </td>
	</tr>
	{{/each}}
	</tbody>
      </table>
      </div>
    </div>

  </form>
  <p></p>
  <p>
    Note: driver lines are computed from information about each driver
    line.
  </p>
  {{>derived_title}}
</template>

<template name="neuropil_insert">
  <form>
    <label>Name</label>
    <input type="text" class="name span5">
  </form>
  <p></p>
  <p>
    Note: driver lines are computed from information about each driver
    line and neuron types are computed from information about each
    neuron type.
  </p>
  {{>derived_title}}
</template>

<template name="derived_title">
  <div class="btn btn-default btn-tiny">
    <i class="fa fa-download"></i> From remote data
  </div>
</template>

<!-- ---------------------------- -->

<template name="FlyCircuitPanel">
  {{#detail_block}}
    {{#detail_title}}
      FlyCircuit.tw links
    {{/detail_title}}
    {{#detail_main}}
      <p></p>
      <div class="tags-div">
	<div class="item-tags">
          {{#each idid_dicts}}
<div class="btn btn-default btn-small">
	    <div class="pzp1 name"><a href="http://flycircuit.tw/modules.php?name=clearpage&op=detail_table&idid={{name}}">{{name}}</a></div>
	    <div class="pzp2 remove"><i class="fa fa-trash-o"></i></div>
	  </div>
	  {{/each}}
          {{#if adding_flycircuit_idid}}
            <div class="tag edit-flycircuit-idid">
              <input type="text" id="edit-flycircuit-input" value="" >
            </div>
          {{else}}
            <div class="tag add-flycircuit-idid">
              <a class="btn btn-default btn-small insert" href="#">
               <i class="fa fa-plus"></i> Add idid</a>
            </div>
          {{/if}}
        </div>
      </div>
    {{/detail_main}}
  {{/detail_block}}
</template>

<template name="show_comments">
  {{#each wrapped_comments}}
  <div class="entire-comment-region">
    <div class="remove-indiv-comment">
      <div>
	<a class="btn btn-danger btn-small delete" href="#" title="delete comment"><i class="fa fa-trash-o"></i> delete</a>
      </div>
<!--
      <div>
	<a class="btn btn-default btn-small edit" href="#"><i class="fa fa-pencil-square-o"></i> edit</a>
      </div>
-->
    </div>
    <div class="indiv-comment">
      {{{show_markdown comment}}}
      <div class="comment-user-date">
        {{> show_user_date comment}}
      </div>
    </div>
  </div>
  {{/each}}
</template>

<!-- ---------------------------- -->

<template name="show_user_date">
   {{pretty_time}} by {{pretty_username}}
</template>

<!-- ---------------------------- -->

<template name="binary_data_table">
  <div class="flex-images">
    {{#each binary_data}}
      {{#binary_data_from_id_block}}
        {{#if has_thumb}}
          <div class="item {{selectable_class}}" id={{_id}} data-w={{thumb_width}} data-h={{thumb_height}}>
	    {{#if ../../selectable_not_clickable}}
              <img src={{thumb_src}} data-src={{thumb_src}} width={{thumb_width}} height={{thumb_height}}>
	    {{else}}
              <a href="{{pathFor 'binary_data_show'}}">
                <img src={{thumb_src}} data-src={{thumb_src}} width={{thumb_width}} height={{thumb_height}}>
              </a>
	    {{/if}}
          </div>
        {{else}}
          <div class="item no-thumb-item {{selectable_class}}" id={{_id}} data-w="150" data-h="200">
	    {{#if ../../selectable_not_clickable}}
	      {{name}}
	    {{else}}
              <a href="{{pathFor 'binary_data_show'}}">{{name}}</a>
	    {{/if}}
	    <p>No thumbnail available.</p>
          </div>
        {{/if}}
      {{/binary_data_from_id_block}}
    {{/each}}
  </div>
  {{#if selectable_not_clickable}}
    <div class="right-text">
      {{get_n_selected}} selected.
    </div>
  {{/if}}
</template>

<template name="AddImageCode2">
  <div>
      Images and volumes
      <a class="btn btn-default btn-small edit-images" href="#"><i class="fa fa-pencil-square-o"></i> edit</a>
  </div>
</template>

<template name="add_image_code">
  <div>
    <a class="btn btn-default btn-small insert" href="#">
      <i class="fa fa-plus"></i> Add new image or volume</a>
  </div>
</template>

<template name="LinkExistingImageDialog">
  <p>Select images and volumes to link from {{friendly_item_name}}</p>
  <div class="alert alert-warning" role="alert">
    <i class="fa fa-exclamation-triangle"></i>This will adjust all
    images linked from {{friendly_item_name}}. Removing the originally selected
    images will remove their links permanently.
  </div>
  {{> binary_data_table binary_data=binary_data_cursor selectable_not_clickable=true}}
</template>

<template name="insert_image_dialog">
  <div id="file_form_div">
    <form role="form" id="insert_image_form">
      <input type="file" id="insert_image">
    </form>
  </div>
</template>

<template name="PageNotFound">
    <div>
        <h2>404 - page not found</h2>
	<p>The page you requested may not exist or you may not have
	permission to see it.</p>

	{{#if currentUser}}{{else}}<p>{{login_message}}</p>{{/if}}
    </div>
</template>

<template name="config">
  <h2>Configuration</h2>

  {{#if currentUser}}

  {{#detail_block}}
    {{#detail_title}}
	Website text configuration
    {{/detail_title}}
    {{#detail_main}}

    {{#with config_doc}}
      {{> quickForm collection="NeuronCatalogConfig" doc=this id="{{_id}}" type="update" buttonContent="Save" }}
    {{/with}}

    {{/detail_main}}
  {{/detail_block}}

  {{/if}}

  {{#detail_block}}
    {{#detail_title}}
	Website setup validation
    {{/detail_title}}
    {{#detail_main}}
      <p>
      <button type="button" class="btn btn-default verify-aws">Verify AWS configuration</button>
      </p>
    {{/detail_main}}
  {{/detail_block}}

    {{#if currentUser}}
  {{#detail_block}}
    {{#detail_title}}
	Database validation
    {{/detail_title}}
    {{#detail_main}}
  <ul>
    {{#each collection_names}}
    <li>
      {{this}} <button type="button" class="btn btn-default validate-docs" data-repair="0" data-collection={{this}}>Validate</button> <button type="button" class="btn btn-default validate-docs" data-repair="1" data-collection={{this}}>Attempt repair</button> (see javascript console)
    </li>

    {{/each}}
  </ul>
    {{/detail_main}}
  {{/detail_block}}

  {{> raw_button collection="Meteor.users" my_id=current_user_id button_text="View user document for current user" }}

    {{else}}
      <li>Other configuration options available if you log in.</li>
    {{/if}}

</template>

<template name="ConfigAWSTestDialog">
  <h2>AWS configuration test</h2>
    <div class="progress">
      <div class="progress-bar progress-bar-striped {{is_active}}"  role="progressbar" aria-valuenow="{{percent_done}}" aria-valuemin="0" aria-valuemax="100" style="width: {{percent_done}}%">
	<span class="sr-only">{{percent_done}}% Complete</span>
      </div>
    </div>
  {{#if result}}
    {{result.msg}}
    {{#if result.has_error}}
      <ul>
      {{#each result.failures}}
        <li>{{this}}</li>
      {{/each}}
      </ul>
    {{/if}}
  {{else}}
  {{/if}}
</template>
